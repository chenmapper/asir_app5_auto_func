# 📘 asir\_app5\_通用加入公式 v1.0

一個基於 Streamlit 的 Excel 公式批量生成與檢測工具，整合：

* **SUMIF 生成（含 COUNT）**：依條件與加總欄，自動插入 COUNTIF/COUNTIFS 及 SUMIF/SUMIFS 公式。
* **VLOOKUP 生成**：動態組合查找表與比對表，批量插入 VLOOKUP 公式，支援子集篩選。
* **多欄合一**：將來源工作表中 2\~4 欄位內容以 `_` 連結，生成新工作表，建立資料節點網絡。
* **SUM 檢測**：識別橫向／縱向連續 3 筆以上數值符合 SUM 關係，自動插入 SUM 公式並上色標示。

---

## 功能模式（Mode）

1. **SUMIF 生成**

   * 選擇來源工作表、條件1/2（可空）、篩選欄(可空)及加總欄，批量生成 COUNTIF/COUNTIFS 與 SUMIF/SUMIFS 公式；
   * 結果寫入 `sumif_result` 工作表，可累加多次；
   * 下載包含所有公式結果的 `result_通用公式.xlsx`。

2. **VLOOKUP 生成**

   * 設定查找工作表、查找欄、子集篩選(可空)、比對工作表、起始欄與擷取欄位；
   * 動態命名結果工作表 (`vlookup_{查找表}_{子集欄}_{子集值}` 或 `vlookup_{查找表}`)；
   * 批量插入 VLOOKUP 公式到結果表；
   * 統一下載 `result_通用公式.xlsx`。

3. **多欄合一**

   * 選擇來源工作表與 2\~4 欄位；
   * 自動複製來源表內容，並插入第一欄，將所選欄位值以 `_` 連結（如 `縣市_分局`）；
   * 結果寫入 `link_{來源工作表}`；
   * 可避免同名節點誤連、建立自定義索引。

4. **SUM 檢測**

   * 掃描所有工作表中的每列／每欄，尋找落在 3 筆以上的連續群組，若其儲存格值等於群組總和；
   * 自動插入對應的 SUM 公式並以黃色標示；
   * 支援字串與空值過濾，僅對數值欄位計算。

---

## 安裝

```bash
pip install -r requirements.txt
# or
pip install streamlit pandas openpyxl numpy
```

---

## 使用

1. 啟動應用：

   ```bash
   streamlit run asir_app5_通用加入公式.py
   ```
2. 在瀏覽器側邊欄選擇功能模式，依提示上傳 `.xlsx` 檔案並設定參數。
3. 點擊「生成」或「開始 SUM 檢測」，公式將自動插入至對應工作表。
4. 點擊「下載結果」可獲取整合後的 `result_通用公式.xlsx`。

---

## 專案結構

```
case5/
├─ asir_app5_通用加入公式.py    # 主程式
├─ README.md                     # 專案說明（本檔）
├─ requirements.txt              # 依賴清單
└─ .gitignore                    # 忽略規則
```

---

## 授權

MIT License

---

> 本工具結合多種批量公式生成與檢測策略，幫助使用者快速為 Excel 資料建置分析模型與資料關聯索引，適用於報表自動化、資料清洗與資料整合等場景。

# 預期效果與效益

1\. 快速辨識與轉換公式欄位，節省人工作業

2\. 增進學員對 Excel 函數邏輯理解

3\. 作為教學範例與自動化工具的整合平台

4\. 可拓展至更多公式、自訂邏輯與 AI 智慧生成
